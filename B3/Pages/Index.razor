@page "/"
@inject GameService GameService
@inject NavigationManager NavigationManager

<h3>Lägg till Spelare</h3>
<form>
    <input type="text" @bind="NewPlayer" placeholder="Spelarens namn" />
    <button type="button" @onclick="AddPlayer">Lägg till</button>
</form>

<h3>Lägg till Gren</h3>
<form>
    <input type="text" @bind="NewEvent" placeholder="Gren" />
    <button type="button" @onclick="AddEvent">Lägg till</button>
</form>

<h3>Spelare</h3>
<ul>
    @foreach (var player in GameService.PlayerList)
    {
        <li>
            @player.Name
            <button type="button" @onclick="() => RemovePlayer(player)">Ta bort</button>
        </li>
    }
</ul>

<h3>Grenar</h3>
<ul>
    @foreach (var eventItem in GameService.EventList)
    {
        <li>
            @eventItem.Name
            <button type="button" @onclick="() => RemoveEvent(eventItem)">Ta bort</button>
        </li>
    }
</ul>

<h3>Tilldela spelare till gren</h3>
<form>
    <select @bind="SelectedPlayer">
        <option value="">Välj spelare</option>
        @foreach (var player in GameService.PlayerList)
        {
            <option value="@player.Name">@player.Name</option>
        }
    </select>
    <select @bind="SelectedEvent">
        <option value="">Välj gren</option>
        @foreach (var eventItem in GameService.EventList)
        {
            <option value="@eventItem.Name">@eventItem.Name</option>
        }
    </select>
    <button type="button" @onclick="AssignPlayerToEvent">Tilldela</button>
</form>

<h3>Anmälda spelare per gren</h3>
@foreach (var eventItem in GameService.EventList)
{
    <h4>@eventItem.Name</h4>
    <table>
        <thead>
            <tr>
                <th>Spelare</th>
                <th>Poäng</th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            @foreach (var player in GameService.PlayerList.Where(p => p.AssignedEvent == eventItem))
            {
                <tr>
                    <td>@player.Name</td>
                    <td>@player.Score</td>
                    <td>
                        <button type="button" @onclick="() => IncreaseScore(player)">Lägg till Poäng</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
}

<button type="button" @onclick="ShowResults">Avsluta</button>


@code {
    private string NewPlayer;
    private string NewEvent;
    private string SelectedPlayer;
    private string SelectedEvent;

    private void AddPlayer()
    {
        GameService.PlayerList.Add(new Player { Name = NewPlayer, Score = 0 });
        NewPlayer = string.Empty;
    }

    private void AddEvent()
    {
        GameService.EventList.Add(new Event { Name = NewEvent });
        NewEvent = string.Empty;
    }

    private void RemovePlayer(Player player)
    {
        GameService.PlayerList.Remove(player);
    }

    private void RemoveEvent(Event eventItem)
    {
        GameService.EventList.Remove(eventItem);
    }

    private void AssignPlayerToEvent()
    {
        var selectedPlayer = GameService.PlayerList.FirstOrDefault(p => p.Name == SelectedPlayer);
        var selectedEvent = GameService.EventList.FirstOrDefault(e => e.Name == SelectedEvent);

        if (selectedPlayer != null && selectedEvent != null)
        {
            selectedPlayer.AssignedEvent = selectedEvent;
        }

        SelectedPlayer = string.Empty;
        SelectedEvent = string.Empty;
    }

    private void IncreaseScore(Player player)
    {
        player.Score++;
    }

    private void ShowResults()
    {
        NavigationManager.NavigateTo("results");
    }
}
